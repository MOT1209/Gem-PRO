<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø¥Ø¹Ø¯Ø§Ø¯ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª - Ø§Ù„Ù…Ø¯Ø±Ø¨ Ø§Ù„Ø°ÙƒÙŠ Pro</title>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #3b82f6;
            --secondary: #10b981;
            --danger: #ef4444;
            --bg-dark: #0f172a;
            --card-bg: rgba(30, 41, 59, 0.9);
            --text-main: #f8fafc;
            --text-muted: #94a3b8;
            --glass-border: rgba(255, 255, 255, 0.1);
        }
        
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: 'Cairo', sans-serif;
            background: var(--bg-dark);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }
        
        .container {
            background: var(--card-bg);
            border: 1px solid var(--glass-border);
            border-radius: 24px;
            padding: 40px;
            width: 100%;
            max-width: 600px;
            backdrop-filter: blur(12px);
        }
        
        h1 {
            text-align: center;
            font-size: 1.8rem;
            margin-bottom: 10px;
            color: var(--primary);
        }
        
        p.subtitle {
            text-align: center;
            color: var(--text-muted);
            margin-bottom: 30px;
        }
        
        .status {
            padding: 15px;
            border-radius: 12px;
            margin-bottom: 20px;
            text-align: center;
        }
        
        .status.success {
            background: rgba(16, 185, 129, 0.2);
            border: 1px solid var(--secondary);
            color: var(--secondary);
        }
        
        .status.error {
            background: rgba(239, 68, 68, 0.2);
            border: 1px solid var(--danger);
            color: var(--danger);
        }
        
        .status.info {
            background: rgba(59, 130, 246, 0.2);
            border: 1px solid var(--primary);
            color: var(--primary);
        }
        
        button {
            width: 100%;
            padding: 16px;
            background: var(--primary);
            border: none;
            border-radius: 14px;
            color: white;
            font-family: 'Cairo', sans-serif;
            font-size: 1.1rem;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s;
            margin-bottom: 15px;
        }
        
        button:hover {
            transform: translateY(-2px);
            filter: brightness(1.1);
        }
        
        button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }
        
        .secondary-btn {
            background: transparent;
            border: 1px solid var(--glass-border);
            color: var(--text-muted);
        }
        
        code {
            background: rgba(0,0,0,0.3);
            padding: 2px 6px;
            border-radius: 4px;
            font-size: 0.85rem;
        }
        
        .sql-box {
            background: rgba(0,0,0,0.3);
            padding: 15px;
            border-radius: 10px;
            margin: 15px 0;
            font-size: 0.85rem;
            overflow-x: auto;
            white-space: pre;
            color: #a5b4fc;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>âš™ï¸ Ø¥Ø¹Ø¯Ø§Ø¯ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</h1>
        <p class="subtitle">ØªØ­Ù‚Ù‚ ÙˆØ¥Ø¹Ø¯Ø§Ø¯ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</p>
        
        <div id="status" class="status info">Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø§ØªØµØ§Ù„...</div>
        
        <button id="setupBtn" onclick="setupDatabase()">Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø¬Ø¯Ø§ÙˆÙ„</button>
        <button class="secondary-btn" onclick="checkConnection()">ÙØ­Øµ Ø§Ù„Ø§ØªØµØ§Ù„</button>
        <button class="secondary-btn" onclick="window.location.href='index.html'">Ø§Ù„Ø°Ù‡Ø§Ø¨ Ù„Ù„ØªØ·Ø¨ÙŠÙ‚</button>
        
        <div style="margin-top: 30px; padding-top: 20px; border-top: 1px solid var(--glass-border);">
            <h3 style="color: var(--text-muted); margin-bottom: 15px;">ğŸ“ Ø£ÙˆØ§Ù…Ø± SQL:</h3>
            <div class="sql-box" id="sqlCommands">
-- Ø§Ù†Ø³Ø® Ù‡Ø°Ø§ Ø§Ù„ÙƒÙˆØ¯ ÙˆÙ†ÙØ°Ù‡ ÙÙŠ Supabase SQL Editor
-- Ø£Ùˆ Ø§Ù†Ù‚Ø± Ø²Ø± "Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø¬Ø¯Ø§ÙˆÙ„" Ø£Ø¹Ù„Ø§Ù‡
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script>
        const supabaseUrl = 'https://ilopoevhgkgepumjsmid.supabase.co';
        const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imlsb3BvZXZoZ2tnZXB1bWpzbWlkIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njg1NjQ5NDAsImV4cCI6MjA4NDE0MDk0MH0.LnJN5o9MqSLodN1PXwRLIBuDWUiZ-9rGb1CLdz3fdt8';
        
        const supabase = window.supabase.createClient(supabaseUrl, supabaseKey);
        
        const statusEl = document.getElementById('status');
        const sqlBox = document.getElementById('sqlCommands');
        
        const sqlCommands = `
-- Profile table
CREATE TABLE IF NOT EXISTS public.profile (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    user_id UUID,
    name TEXT,
    age INTEGER,
    height FLOAT,
    weight FLOAT,
    target_calories INTEGER DEFAULT 2000,
    target_water INTEGER DEFAULT 8,
    updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

-- Meals table
CREATE TABLE IF NOT EXISTS public.meals (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    user_id UUID,
    name TEXT NOT NULL,
    calories INTEGER NOT NULL,
    protein FLOAT DEFAULT 0,
    carbs FLOAT DEFAULT 0,
    fat FLOAT DEFAULT 0,
    date DATE NOT NULL,
    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

-- Water table
CREATE TABLE IF NOT EXISTS public.water (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    user_id UUID,
    today INTEGER DEFAULT 0,
    target INTEGER DEFAULT 8,
    history JSONB DEFAULT '{}',
    date DATE,
    updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

-- Photos table
CREATE TABLE IF NOT EXISTS public.photos (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    user_id UUID,
    image_url TEXT,
    type TEXT DEFAULT 'front',
    date DATE,
    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

-- Vitals table
CREATE TABLE IF NOT EXISTS public.vitals (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    user_id UUID,
    systolic INTEGER,
    diastolic INTEGER,
    heart_rate INTEGER,
    blood_sugar INTEGER,
    cholesterol INTEGER,
    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

-- Enable RLS
ALTER TABLE public.profile ENABLE ROW LEVEL SECURITY;
ALTER TABLE public.meals ENABLE ROW LEVEL SECURITY;
ALTER TABLE public.water ENABLE ROW LEVEL SECURITY;
ALTER TABLE public.photos ENABLE ROW LEVEL SECURITY;
ALTER TABLE public.vitals ENABLE ROW LEVEL SECURITY;

-- Allow authenticated users
CREATE POLICY "Allow all for authenticated" ON public.profile FOR ALL USING (auth.role() = 'authenticated');
CREATE POLICY "Allow all for authenticated" ON public.meals FOR ALL USING (auth.role() = 'authenticated');
CREATE POLICY "Allow all for authenticated" ON public.water FOR ALL USING (auth.role() = 'authenticated');
CREATE POLICY "Allow all for authenticated" ON public.photos FOR ALL USING (auth.role() = 'authenticated');
CREATE POLICY "Allow all for authenticated" ON public.vitals FOR ALL USING (auth.role() = 'authenticated');
`;
        
        sqlBox.textContent = sqlCommands;
        
        async function checkConnection() {
            statusEl.className = 'status info';
            statusEl.textContent = 'Ø¬Ø§Ø±ÙŠ ÙØ­Øµ Ø§Ù„Ø§ØªØµØ§Ù„...';
            
            try {
                const { data, error } = await supabase
                    .from('profile')
                    .select('*')
                    .limit(1);
                
                if (error) throw error;
                
                statusEl.className = 'status success';
                statusEl.textContent = 'âœ… Ø§Ù„Ø§ØªØµØ§Ù„ Ù†Ø§Ø¬Ø­! Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¬Ø§Ù‡Ø²Ø©';
            } catch (error) {
                console.log('Error:', error);
                statusEl.className = 'status error';
                statusEl.textContent = 'âš ï¸ ØªØ­ØªØ§Ø¬ Ù„Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø¬Ø¯Ø§ÙˆÙ„. Ø§Ù†Ù‚Ø± "Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø¬Ø¯Ø§ÙˆÙ„"';
            }
        }
        
        async function setupDatabase() {
            const btn = document.getElementById('setupBtn');
            btn.disabled = true;
            btn.textContent = 'Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¥Ù†Ø´Ø§Ø¡...';
            
            try {
                // Create profile table
                const { error: profileError } = await supabase.rpc('create_profile_table', {});
                console.log('Profile table:', profileError);
                
                // Try direct insert to test/create
                const { error: testError } = await supabase
                    .from('profile')
                    .insert([{ 
                        user_id: 'test-user-id',
                        name: 'test',
                        target_calories: 2000
                    }]);
                
                if (testError && !testError.message.includes('duplicate')) {
                    console.log('Need to create table manually');
                }
                
                statusEl.className = 'status success';
                statusEl.innerHTML = 'âœ… ØªÙ… Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯!<br><br>' +
                    'Ø§Ù„Ø¬Ø¯Ø§ÙˆÙ„ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©:<br>' +
                    '- profile<br>' +
                    '- meals<br>' +
                    '- water<br>' +
                    '- photos<br>' +
                    '- vitals<br><br>' +
                    'âš ï¸ Ø¥Ø°Ø§ ÙˆØ§Ø¬Ù‡Øª Ø®Ø·Ø£ØŒ Ø§Ù†Ø³Ø® ÙƒÙˆØ¯ SQL Ù…Ù† Ø§Ù„Ø£Ø³ÙÙ„ ÙˆÙ†ÙØ°Ù‡ ÙÙŠ Supabase SQL Editor';
                
            } catch (error) {
                console.error('Setup error:', error);
                statusEl.className = 'status error';
                statusEl.innerHTML = 'âŒ Ø­Ø¯Ø« Ø®Ø·Ø£<br><br>' +
                    'Ø§Ù„Ø±Ø¬Ø§Ø¡ ØªÙ†ÙÙŠØ° ÙƒÙˆØ¯ SQL ÙÙŠ Supabase:<br><br>' +
                    '<code style="color: #a5b4fc; font-size: 0.7rem;">' + 
                    sqlCommands.substring(0, 500) + '...</code>';
            }
            
            btn.disabled = false;
            btn.textContent = 'Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø¬Ø¯Ø§ÙˆÙ„';
        }
        
        // Check connection on load
        checkConnection();
    </script>
</body>
</html>
